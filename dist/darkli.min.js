!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Darkli=t()}(this,function(){"use strict";function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.URL,n=e.replace(/[[\]]/g,"\\$&"),o=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function t(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)}function n(e){var t=this;new Promise(function(e){return t.config.beforeOpen?(t.config.beforeOpen(),e()):e()}).then(new Promise(function(n){var o,i=function(e,t,n){var o=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(o)?e.replace(o,"$1"+t+"="+n+"$2"):e+i+t+"="+n}(document.URL,"darkli",e);window.history.pushState(e,null,i),t.config.box.classList.add("is-active");var r=["is-active"];return t.config.heightAuto&&r.push("is-height-auto"),(o=t.config.box.querySelector("[data-darkli-content="+e+"]").classList).add.apply(o,r),n()})).then(new Promise(function(e){return t.config.afterOpen?(t.config.afterOpen(),e()):e()}))}var o={box:".darkli",contents:".darkli-content",btnOpens:"[data-darkli]",btnClose:".darkli .darkli-close",heightAuto:!1},i=/(youtube(-nocookie)?\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?([\w-]{11})(.*)?/i,r=function(e){return'\n  <div class="darkli-iframe-container">\n    <iframe frameborder="0" src="'+e+'" allowfullscreen></iframe>\n  </div>\n'},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var c=function(){function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),this.version="0.5.0",this.author="Rex Tsou <akccakccwww@gmail.com>",this.bugs="https://github.com/akccakcctw/darkli/issues",this.license="WTFPL",this.moduleName="darkli",this.config=Object.assign(o,e),this.init()}return a(c,[{key:"open",value:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];n.apply(this,t)}},{key:"close",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];(function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.config.box.classList.contains("is-active")&&new Promise(function(t){return e.config.beforeClose?(e.config.beforeClose(),t()):t()}).then(new Promise(function(n){return e.config.box.classList.remove("is-active"),e.config.box.querySelectorAll(".darkli-content").forEach(function(e){e.classList.contains("auto-destroy")&&e.parentNode.removeChild(e),e.classList.remove("is-active")}),!0===t&&window.history.go(-1),n()})).then(new Promise(function(t){return e.config.afterClose?(e.config.afterClose(),t()):t()}))}).apply(this,t)}},{key:"create",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.box,n=void 0===t?this.config.box:t,o=e.isExternal,i=void 0!==o&&o,r=e.autoDestroy,a=void 0!==r&&r,c=e.content,s=(+new Date).toString(36),l=document.createElement("div");l.classList.add("darkli-content"),l.setAttribute("data-darkli-content",s),i&&l.classList.add("is-external"),a&&l.classList.add("auto-destroy"),l.innerHTML=c,n.appendChild(l),this.open(s)}).apply(this,t)}},{key:"external",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];(function(e){i.exec(e)&&this.create({content:r(e),isExternal:!0,autoDestroy:!0})}).apply(this,t)}},{key:"init",value:function(){var n=this;if(Object.assign(this.config,{box:t(this.config.box),btnOpens:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelectorAll(e)}(this.config.btnOpens),btnClose:t(this.config.btnClose)}),null==this.config.box)throw new Error("config.box cannot be null");Array.from(this.config.btnOpens).forEach(function(e){return e.addEventListener("click",function(){e.dataset.darkli?n.open(e.dataset.darkli):n.external(e.getAttribute("href"))})}),e(this.moduleName)&&this.open(e(this.moduleName));return function(){var e=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=n.namespaceURI,i=document.createElementNS(o,e);return Object.keys(t).forEach(function(e){i.setAttribute(e,t[e])}),n.appendChild(i),n}("polygon",{points:"612,36.004 576.521,0.603 306,270.608 35.478,0.603 0,36.004 270.522,306.011 0,575.997 35.478,611.397      306,341.411 576.521,611.397 612,575.997 341.459,306.011    "});e.classList.add("darkli-icon"),e.setAttribute("viewBox","0 0 612 612"),n.config.btnClose.appendChild(e)}(),this.config.btnClose.addEventListener("click",function(){n.close()}),document.addEventListener("mouseup",function(e){var o=t(".darkli .darkli-content");e.target.matches(".darkli .darkli-content")||o.contains(e.target)||n.close()}),document.addEventListener("keyup",function(e){27!==e.keyCode&&8!==e.keyCode||n.close()}),window.addEventListener("popstate",function(){n.close(!1)}),this}}],[{key:"noConflict",value:function(){return window.darkli=void 0,c}}]),c}();return"undefined"==typeof exports&&void 0!==window.darkli&&(console.log("darkli already defined. Rename it as `Otherdarkli`"),window.Otherdarkli=window.darkli,window.darkli=c),c});