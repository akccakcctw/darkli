!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Darkli=t()}(this,function(){"use strict";var n={box:".darkli",contents:".darkli-content",btnOpens:"[data-darkli]",btnClose:".darkli .darkli-close",heightAuto:!1,closeKeys:[27,8]};function c(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.URL,n=e.replace(/[[\]]/g,"\\$&"),o=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function s(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)}function o(l){var d=this;new Promise(function(e){return d.config.beforeOpen&&d.config.beforeOpen(),e()}).then(new Promise(function(e){var t,n,o,i,r,a,c=(n=document.URL,o="darkli",i=l,r=new RegExp("([?&])"+o+"=.*?(&|$)","i"),a=-1!==n.indexOf("?")?"&":"?",n.match(r)?n.replace(r,"$1"+o+"="+i+"$2"):n+a+o+"="+i);window.history.pushState(l,null,c),d.config.box.classList.add("is-active");var s=["is-active"];return d.config.heightAuto&&s.push("is-height-auto"),(t=d.config.box.querySelector("[data-darkli-content="+l+"]").classList).add.apply(t,s),e()})).then(new Promise(function(e){return d.config.afterOpen&&d.config.afterOpen(),e()}))}var i=/(youtube(-nocookie)?\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?([\w-]{11})(.*)?/i,r=function(e){return'\n  <div class="darkli-iframe-container">\n    <iframe frameborder="0" src="'+e+'" allowfullscreen></iframe>\n  </div>\n'};var e=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.version="0.6.0",this.author="Rex Tsou <akccakccwww@gmail.com>",this.bugs="https://github.com/akccakcctw/darkli/issues",this.license="WTFPL",this.moduleName="darkli",this.config=Object.assign(n,e),this.init()}return e(t,[{key:"open",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.apply(this,t)}},{key:"close",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];(function(){var t=this,n=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.config.box.classList.contains("is-active")&&new Promise(function(e){return t.config.beforeClose&&t.config.beforeClose(),e()}).then(new Promise(function(e){return t.config.box.classList.remove("is-active"),t.config.box.querySelectorAll(".darkli-content").forEach(function(e){e.classList.contains("auto-destroy")&&e.parentNode.removeChild(e),e.classList.remove("is-active")}),!0===n&&window.history.go(-1),e()})).then(new Promise(function(e){return t.config.afterClose&&t.config.afterClose(),e()}))}).apply(this,t)}},{key:"create",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.box,n=void 0===t?this.config.box:t,o=e.isExternal,i=void 0!==o&&o,r=e.autoDestroy,a=void 0!==r&&r,c=e.content,s=(+new Date).toString(36),l=document.createElement("div");l.classList.add("darkli-content"),l.setAttribute("data-darkli-content",s),i&&l.classList.add("is-external"),a&&l.classList.add("auto-destroy"),l.innerHTML=c,n.appendChild(l),this.open(s)}).apply(this,t)}},{key:"external",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];(function(e){i.exec(e)&&this.create({content:r(e),isExternal:!0,autoDestroy:!0})}).apply(this,t)}},{key:"init",value:function(){var n=this;if(Object.assign(this.config,{box:s(this.config.box),btnOpens:function(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelectorAll(e)}(this.config.btnOpens),btnClose:s(this.config.btnClose)}),null==this.config.box)throw new Error("config.box cannot be null");Array.from(this.config.btnOpens).forEach(function(e){return e.addEventListener("click",function(){e.dataset.darkli?n.open(e.dataset.darkli):n.external(e.getAttribute("href"))})}),c(this.moduleName)&&this.open(c(this.moduleName));var e,t,o,i,r,a;return e="polygon",t={points:"612,36.004 576.521,0.603 306,270.608 35.478,0.603 0,36.004 270.522,306.011 0,575.997 35.478,611.397      306,341.411 576.521,611.397 612,575.997 341.459,306.011    "},o=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=o.namespaceURI,r=document.createElementNS(i,e),Object.keys(t).forEach(function(e){r.setAttribute(e,t[e])}),o.appendChild(r),(a=o).classList.add("darkli-icon"),a.setAttribute("viewBox","0 0 612 612"),n.config.btnClose.appendChild(a),this.config.btnClose.addEventListener("click",function(){n.close()}),document.addEventListener("mouseup",function(e){var t=s(".darkli .darkli-content");e.target.matches(".darkli .darkli-content")||t.contains(e.target)||n.close()}),document.addEventListener("keyup",function(e){n.config.closeKeys.includes(e.keyCode)&&n.close()}),window.addEventListener("popstate",function(){n.close(!1)}),this}}],[{key:"noConflict",value:function(){return window.darkli=void 0,t}}]),t}();return"undefined"==typeof exports&&void 0!==window.darkli&&(console.log("darkli already defined. Rename it as `Otherdarkli`"),window.Otherdarkli=window.darkli,window.darkli=t),t});